<div class="game-container">
  @if (gameState().isCompleted) {
    <!-- Result Screen -->
    <app-result
      [gameState]="gameState()"
      (replay)="onReplay()"
    ></app-result>
  } @else {
    <!-- Active Game Screen -->
    <div class="game-screen">
      <!-- Score Board -->
      <app-score-board
        [currentRound]="currentRound()?.roundNumber ?? 1"
        [totalRounds]="5"
        [currentScore]="currentRound()?.score ?? 0"
        [totalScore]="gameState().totalScore"
      ></app-score-board>

      <!-- Target Color Display -->
      @if (currentRound()) {
        <div class="target-section">
          <h2 class="target-title" id="target-color-title">Find this color:</h2>
          <div class="target-color-display"
               role="img"
               [attr.aria-label]="'Target color: RGB ' + currentRound()!.targetColor.r + ', ' + currentRound()!.targetColor.g + ', ' + currentRound()!.targetColor.b"
               [style.background-color]="'rgb(' + currentRound()!.targetColor.r + ', ' + currentRound()!.targetColor.g + ', ' + currentRound()!.targetColor.b + ')'">
          </div>
          @if (!isRoundCompleted()) {
            <p class="instruction-text">Select the matching color from the palette below</p>
          }
        </div>

        <!-- Color Palette -->
        <app-color-palette
          [colors]="currentRound()!.paletteColors"
          [disabled]="isRoundCompleted()"
          (colorSelected)="onColorSelected($event)"
        ></app-color-palette>

        <!-- Round Result Dialog -->
        @if (showDialog() && currentRound() && currentRound()!.selectedColor) {
          <app-round-result-dialog
            [targetColor]="currentRound()!.targetColor"
            [selectedColor]="currentRound()!.selectedColor!"
            [score]="currentRound()!.score!"
            [distance]="currentRound()!.distance!"
            [isLastRound]="isLastRound()"
            (nextRound)="onDialogNextRound()"
          ></app-round-result-dialog>
        }
      }
    </div>
  }
</div>
